{% extends 'posts/base.html' %}
{% load static %}
{% block title %}Home - InstaClone{% endblock %}

{% block content %}
<div class="row" style="justify-content: center;">
  <!-- Posts Feed -->
  <div class="row justify-content-center">

    <!-- FEED COLUMN -->
    <div class="col-12 col-md-8 col-lg-6">

      <!-- STORIES BAR (ABOVE POSTS) -->
      <!-- STORIES BAR -->
      <div class="stories-wrapper">
        <div class="stories-bar">

          <!-- YOUR STORY (ALWAYS SHOWS) -->
          <div class="story-item">

            <!-- Click image = view story -->
            <a href="{% url 'view_story' user.id %}">
              <div class="story-avatar {% if user.id in active_story_users %}ring{% endif %}">
                <img src="{{ user.profile.profile_image.url }}" alt="Your story">
              </div>
            </a>

            <!-- Click + = upload new story -->
            <a href="{% url 'upload_story' %}" class="story-plus">+</a>

            <span class="story-name">Your story</span>
          </div>

          <!-- OTHER USERS -->
          {% for profile in profiles %}
          {% if profile.user.id in active_story_users and profile.user != user %}
          <div class="story-item">
            <a href="{% url 'view_story' profile.user.id %}">
              <div class="story-avatar ring">
                <img src="{{ profile.profile_image.url }}" alt="{{ profile.user.username }}">
              </div>
            </a>
            <span class="story-name">
              {{ profile.user.username|truncatechars:9 }}
            </span>
          </div>
          {% endif %}
          {% endfor %}

        </div>
      </div>


      <!-- POSTS START HERE -->
      {% for post in posts %}
      <!-- your post card -->
      {% endfor %}

    </div>
  </div>


  <div class="col-md-8">
    {% for post in posts %}
    <div class="post-card p-3 mb-4">

      <!-- Header -->
      <div class="d-flex align-items-center justify-content-between mb-2">
        <div class="d-flex align-items-center">
          <img src="{{ post.user.profile.profile_image.url }}" class="profile-pic me-2" alt="pf">
          <div>
            <a href="{% url 'profile' post.user.username %}" class="fw-bold text-white text-decoration-none">
              {{ post.user.username }}
            </a>
            <div class="text-white small">{{ post.created_at|date:"M d, Y H:i" }}</div>
          </div>
        </div>

        <!-- 3-dot dropdown -->
        <div class="dropdown">
          <button class="btn p-0 text-white fs-4" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            â‹¯
          </button>
          <ul class="dropdown-menu dropdown-menu-end shadow-sm">
            {% if post.user == user %}
            <li><a class="dropdown-item text-danger" href="{% url 'delete_post' post.id %}">Delete</a></li>
            {% endif %}
            <li><a class="dropdown-item text-warning" href="#" data-bs-toggle="modal"
                data-bs-target="#reportModal{{ post.id }}">Report</a></li>
          </ul>
        </div>
      </div>

      <!-- Post Image -->
      <div class="mb-2">
        <a href="{% url 'post_detail' post.pk %}">
          <img src="{{ post.image.url }}" class="post-image" alt="post image">

        </a>
      </div>

      <!-- Like and Comment Buttons -->
      <div class="d-flex align-items-center gap-2 mt-2">
        <!-- Like -->
        <button class="glass-btn like-btn {% if user in post.likes.all %}active{% endif %}"
          data-post-id="{{ post.pk }}">
          <svg xmlns="http://www.w3.org/2000/svg" fill="{% if user in post.likes.all %}red{% else %}none{% endif %}"
            stroke="red" viewBox="0 0 24 24" width="20" height="20">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
                     2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81
                     14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0
                     3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
          <span class="like-count text-white">{{ post.likes.count }}</span>
        </button>

        <!-- Comment -->
        <button class="glass-btn comment-btn text-white" data-post-id="{{ post.pk }}" data-bs-toggle="modal"
          data-bs-target="#commentModal">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20"
            height="20">
            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" />
          </svg>
          <span class="comment-count text-white">{{ post.comments.count }}</span>
        </button>
      </div>

      <!-- Caption and comments -->

      
 <div class="glass-comments">

  <!-- VIEW ALL -->
  {% if post.comments.count > 2 %}
<button class="toggle-comments-btn"
        onclick="toggleComments('{{ post.pk }}', this)">
  View {{ post.comments.count }} comments
</button>
  {% endif %}

  <!-- COMMENTS WRAPPER -->
  <div id="comments-{{ post.id }}" class="comments-wrapper d-none">

    {% for comment in post.comments.all %}
    {% if not comment.parent %}

    <!-- COMMENT -->
    <div class="comment-item" id="comment-{{ comment.id }}">
      <strong>{{ comment.user.username }}</strong>
      {{ comment.content }}

      <div class="comment-actions">
        <button class="reply-btn" onclick="openReplyForm('{{ comment.id }}')">
          Reply
        </button>

        {% if comment.user == user %}
        <button onclick="deleteComment('{{ comment.id }}')" class="delete-comment-btn">
          ðŸ—‘
        </button>
        {% endif %}
      </div>
    </div>

    <!-- REPLY FORM -->
    <div class="reply-form d-none" id="reply-form-{{ comment.id }}">
  <input type="text"
         class="form-control form-control-sm"
         placeholder="Reply..."
         id="reply-input-{{ comment.id }}">

  <button type="button"
          class="btn btn-sm btn-primary mt-1"
          onclick="submitReply({{ post.id }}, {{ comment.id }})">
    Reply
  </button>
</div>


    <!-- REPLIES -->
    {% for reply in comment.replies.all %}
    <div class="reply-item" id="comment-{{ reply.id }}">
      <strong>{{ reply.user.username }}</strong>
      {{ reply.content }}

      {% if reply.user == user %}
      <button onclick="deleteComment('{{ reply.id }}')" class="delete-comment-btn">
        ðŸ—‘
      </button>
      {% endif %}
    </div>
    {% endfor %}

    {% endif %}
    {% endfor %}
  </div>
</div>



    </div>

    <!-- Report Modal -->
    <div class="modal fade" id="reportModal{{ post.id }}" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content glass-modal">
          <div class="modal-header">
            <h5 class="modal-title">Report Post</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <textarea id="reportReason{{ post.id }}" class="form-control" rows="3"
              placeholder="Describe the issue..."></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" onclick="submitReport({{ post.id }})">Report</button>
          </div>
        </div>
      </div>
    </div>

    {% empty %}
    <p class="text-muted">No posts yet â€” follow people to see their posts.</p>
    {% endfor %}
  </div>

</div>

<!-- Comment Modal -->
<div class="modal fade glass-modal" id="commentModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">

      <div class="modal-header">
        <h5 class="modal-title">Add a comment</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <textarea id="commentContent"
                  class="form-control"
                  rows="3"
                  placeholder="Write your comment..."></textarea>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="sendCommentBtn" class="btn btn-primary">Post</button>
      </div>

    </div>
  </div>
</div>




<script>
  function submitReply(postId, parentId) {
  const input = document.getElementById("reply-input-" + parentId);
  const content = input.value.trim();
  if (!content) return;

  fetch(`/comment/${postId}/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": csrftoken,
      "X-Requested-With": "XMLHttpRequest"
    },
    body: new URLSearchParams({
      content: content,
      parent_id: parentId
    })
  })
  .then(res => res.json())
  .then(data => {
    const repliesBox = document.getElementById("replies-" + parentId);

    repliesBox.insertAdjacentHTML("beforeend", `
      <div class="comment-item" id="comment-${data.id}">
        <strong>${data.user}</strong> ${data.content}
        <button onclick="deleteComment(${data.id})" class="btn btn-sm text-danger">ðŸ—‘</button>
      </div>
    `);

    input.value = "";
    document.getElementById("reply-form-" + parentId).classList.add("d-none");
  });
}
function toggleComments(postId, btn) {
  const box = document.getElementById("comments-" + postId);
  box.classList.toggle("d-none");
  btn.innerText = box.classList.contains("d-none")
    ? "View comments"
    : "Hide comments";
}

  function submitReport(postId) {
    const reason = document.getElementById(`reportReason${postId}`).value.trim();
    if (!reason) return alert("Please enter a reason.");

    fetch("{% url 'report_post' 0 %}".replace("0", postId), {
      method: "POST",
      headers: { "X-CSRFToken": getCookie("csrftoken"), "X-Requested-With": "XMLHttpRequest" },
      body: new URLSearchParams({ reason })
    })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          alert("Report submitted successfully âœ…");
          bootstrap.Modal.getInstance(document.getElementById(`reportModal${postId}`)).hide();
          document.getElementById(`reportReason${postId}`).value = "";
        } else {
          alert("Something went wrong.");
        }
      });
  }

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.startsWith(name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  // LIKE HANDLER
  document.querySelectorAll('.like-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      const postId = this.dataset.postId;
      fetch("{% url 'like_post' 0 %}".replace("0", postId), {
        method: "POST",
        headers: { "X-CSRFToken": csrftoken, "X-Requested-With": "XMLHttpRequest" }
      })
        .then(res => res.json())
        .then(data => {
          this.querySelector('.like-count').innerText = data.likes_count;
          const heart = this.querySelector('svg');
          if (data.liked) {
            this.classList.add('active');
            heart.setAttribute('fill', 'red');
            this.animate([{ transform: 'scale(1.3)' }, { transform: 'scale(1)' }], { duration: 200 });
          } else {
            this.classList.remove('active');
            heart.setAttribute('fill', 'none');
          }
        });
    });
  });

  // COMMENT HANDLER
  let currentPostId = null;
  document.querySelectorAll('.comment-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      currentPostId = this.dataset.postId;
    });
  });

  document.getElementById('sendCommentBtn').addEventListener('click', function () {
    const content = document.getElementById('commentContent').value;
    if (!content.trim()) return;

    fetch("{% url 'add_comment' 0 %}".replace("0", currentPostId), {
      method: "POST",
      headers: { "X-CSRFToken": csrftoken, "X-Requested-With": "XMLHttpRequest" },
      body: new URLSearchParams({ content })
    })
      .then(res => res.json())
      .then(data => {
        const btn = document.querySelector(`.comment-btn[data-post-id="${currentPostId}"]`);
        btn.querySelector('.comment-count').innerText = data.comments_count;
        document.getElementById('commentContent').value = '';
        bootstrap.Modal.getInstance(document.getElementById('commentModal')).hide();
      });
  });
  function toggleComments(postId, btn) {
    const commentsBox = document.getElementById(`comments-${postId}`);

    if (commentsBox.classList.contains('d-none')) {
      commentsBox.classList.remove('d-none');
      btn.innerText = "Hide comments";
    } else {
      commentsBox.classList.add('d-none');
      btn.innerText = "View comments";
    }
  }

  function deleteComment(commentId) {
    if (!confirm("Delete this comment?")) return;

    fetch(`/comment/delete/${commentId}/`, {
      method: "POST",
      headers: {
        "X-CSRFToken": csrftoken,
        "X-Requested-With": "XMLHttpRequest"
      }
    })
      .then(res => res.json())
      .then(data => {
        if (data.status === "success") {
          const el = document.getElementById(`comment-${commentId}`);
          if (el) el.remove();
        } else {
          alert("Failed to delete comment");
        }
      });
  }
  const offcanvas = document.getElementById('mobileSidebar');

  offcanvas.addEventListener('shown.bs.offcanvas', () => {
    document.body.style.pointerEvents = 'none';
    offcanvas.style.pointerEvents = 'auto';
  });

  offcanvas.addEventListener('hidden.bs.offcanvas', () => {
    document.body.style.pointerEvents = 'auto';
  });

  function showReplyForm(id) {
    const form = document.getElementById(`reply-form-${id}`);
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
  }
  function openReplyForm(id) {
  const form = document.getElementById("reply-form-" + id);
  form.classList.toggle("d-none");
}

function deleteComment(id) {
  fetch(`/comment/delete/${id}/`, {
    method: "POST",
    headers: {
      "X-CSRFToken": "{{ csrf_token }}"
    }
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      document.getElementById("comment-" + id)?.remove();
      location.reload();
    }
  });
}       

document.querySelectorAll(".like-btn").forEach(btn => {
  btn.addEventListener("click", function () {
    const postId = this.dataset.postId;

    fetch(`/like/${postId}/`, {
      method: "POST",
      headers: {
        "X-CSRFToken": getCookie("csrftoken"),
        "X-Requested-With": "XMLHttpRequest"
      }
    })
    .then(res => res.json())
    .then(data => {
      this.querySelector(".like-count").innerText = data.likes_count;

      const heart = this.querySelector("svg");
      if (data.liked) {
        heart.setAttribute("fill", "red");
      } else {
        heart.setAttribute("fill", "none");
      }
    });
  });
});

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.startsWith(name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
// const csrftoken = getCookie('csrftoken');   


fetch(`/like/${postId}/`, {
  method: "POST",
  headers: {
    "X-CSRFToken": csrftoken,
    "X-Requested-With": "XMLHttpRequest"
  }
})
.then(res => res.json())
.then(data => {
  btn.querySelector(".like-count").innerText = data.likes_count;
});


document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".like-btn").forEach(btn => {
    btn.addEventListener("click", function () {
      // your code
    });
  });
});
</script>


<style>
  /* ==========================
   GLOBAL
=========================== */

  body {
    margin: 0px;
    padding: 0px;
    background: black;
    background-size: 400% 400%;
    animation: gradientShift 10s ease infinite;
    font-family: 'Poppins', sans-serif;
    color: white;
  }

  /* @keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
} */

  /* ==========================
   STORIES
=========================== */
  .stories {
    display: flex;
    gap: 12px;
    padding: 10px 0;
  }

  .story-img {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: 2px solid #c13584;
    object-fit: cover;
  }

  @media(max-width: 768px) {
    .story-img {
      width: 50px;
      height: 50px;
    }
  }

  /* ==========================
   POST CARD (NO BOX STYLE)
=========================== */
  .post-card {
    background: none !important;
    border: none !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    padding-bottom: 20px;
    margin-bottom: 35px;
  }

  /* ==========================
   POST HEADER
=========================== */
  .profile-pic {
    width: 45px !important;
    height: 45px !important;
    border-radius: 50%;
    object-fit: cover;
  }

  .username {
    text-decoration: none;
    color: #262626;
    font-weight: 600;
  }

  @media(max-width: 768px) {
    .profile-pic {
      width: 38px !important;
      height: 38px !important;
    }
  }

  /* ==========================
   MAKE FEED SIZE SMALLER (IG SIZE)
=========================== */
  .col-md-8 {
    max-width: 470px !important;
    /* Instagram exact width */
    padding: 0 !important;
  }

  /* Center feed */
  .row {
    display: flex;
    justify-content: center !important;
  }

  /* ==========================
   POST CARD SPACING
=========================== */
  .post-card {
    padding-bottom: 20px !important;
    margin-bottom: 25px !important;
  }

  /* ==========================
   POST IMAGE SIZE FIX
=========================== */
  .post-image {
  width: 100%;
  height: auto;          
  max-height: none;      
  object-fit: contain; 
  background: black;   
}


  .post-image img {
    width: 100%;
    height: 50%;
    object-fit: cover;
    /* KEY LINE */
  }

  /* MOBILE FIX */
  @media(max-width: 768px) {
    .col-md-8 {
      max-width: 100% !important;
    }

    .post-image {
      height: 185px !important;
      /* Smaller for phone */
      box-shadow: none !important;
    }
  }


  /* ==========================
   LIKE / COMMENT BUTTONS
=========================== */
  .like-btn,
  .comment-btn {
    background: none !important;
    border: none !important;
    cursor: pointer;
    padding: 0 !important;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 18px;
    color: #262626;
  }

  .like-btn:hover,
  .comment-btn:hover {
    opacity: 0.7;
  }

  /* ==========================
   REMOVE GLASS EFFECT COMPLETELY
=========================== */
  .glass-btn {
    background: none !important;
    border: none !important;
    backdrop-filter: none !important;
    padding: 0 !important;
    box-shadow: none !important;
  }

  /* ==========================
   DROPDOWN
=========================== */
  .dropdown-menu {
    background: #fff !important;
    border: 1px solid #ddd !important;
    box-shadow: none !important;
  }

  .dropdown-item:hover {
    background: #f2f2f2 !important;
    color: #000 !important;
  }

  /* ==========================
   MODALS
=========================== */
 /* GLASS COMMENT MODAL */
.glass-modal .modal-content {
  background: rgba(255, 255, 255, 0.15) !important;
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border-radius: 18px;
  border: 1px solid rgba(255, 255, 255, 0.25);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  color: white;
}

.glass-modal .modal-header,
.glass-modal .modal-footer {
  border: none;
}

.glass-modal textarea {
  background: rgba(255,255,255,0.15);
  border: none;
  color: white;
  border-radius: 12px;
}

.glass-modal textarea::placeholder {
  color: rgba(255,255,255,0.7);
}

.glass-modal .btn-primary {
  background: linear-gradient(135deg, #0095f6, #1877f2);
  border: none;
  border-radius: 10px;
}

.glass-modal .btn-secondary {
  background: rgba(255,255,255,0.15);
  border: none;
  color: white;
  border-radius: 10px;
}

  /* ==========================
   CARDS / CONTAINERS REMOVE SHADOWS
=========================== */
  .card,
  .story-card,
  .profile-card,
  .feed-card,
  .container,
  .row,
  .col,
  .feed-wrapper {
    background: none !important;
    border: none !important;
    box-shadow: none !important;
  }

  /* ===== GLASS COMMENT DISPLAY ===== */


.comments-list {
  margin-top: 6px;
}

.comments-list.d-none {
  display: none;
}

  .no-comments {
    font-size: 13px;
    color: #ccc;
  }




  /* ===== SHOW / HIDE COMMENTS ===== */
  .toggle-comments-btn {
    background: none;
    border: none;
    color: #9ecbff;
    font-size: 14px;
    font-weight: 500;
    padding: 0;
    margin-bottom: 6px;
    cursor: pointer;
  }

  .toggle-comments-btn:hover {
    text-decoration: underline;
  }

  <style>

  /* =============================
   COMMENTS RESPONSIVE
============================= */
  .glass-comments {
    padding: 6px 0;
  }

  .comment-item {
    margin-bottom: 10px;
    font-size: 14px;
  }

  .comment-main {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    word-break: break-word;
  }

.reply-btn {
  background: none;
  border: none;
  color: #0095f6;
  font-size: 12px;
  cursor: pointer;
}
  /* Replies */
  .replies {
    margin-left: 18px;
    margin-top: 6px;
    border-left: 2px solid rgba(255, 255, 255, 0.1);
    padding-left: 8px;
  }

  .reply-item {
  margin-left: 25px;
  font-size: 14px;
  opacity: 0.9;
}

  /* Reply input */
  .reply-form {
    margin-left: 18px;
    margin-top: 4px;
  }

  .reply-form input {
    width: 75%;
    border-radius: 6px;
    border: 1px solid #444;
    background: #111;
    color: #fff;
    padding: 4px 6px;
    font-size: 13px;
  }

  .reply-form button {
    background: #0095f6;
    border: none;
    color: white;
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 13px;
  }

  /* Mobile tweaks */
  @media (max-width: 480px) {
    .comment-item {
      font-size: 13px;
    }

    .reply-item {
      font-size: 12px;
    }
  }

  .delete-comment-btn {
    background: none;
    border: none;
    color: #ff6b6b;
    font-size: 14px;
    cursor: pointer;
    padding: 0;
  }

  .delete-comment-btn:hover {
    opacity: 0.7;
  }


  /* CENTER STORIES SAME AS POST WIDTH */
  .stories-center-wrapper {
    max-width: 470px;
    margin: 0 auto;
    padding: 0 8px;
  }


  /* EACH STORY MUST NOT TAKE FULL WIDTH */
  .story {
    position: relative;
    width: 70px;
    flex: 0 0 auto;
  }

  /* + BUTTON */
  .add-story-btn {
    position: absolute;
    bottom: 18px;
    right: 6px;
    text-decoration: none;
    z-index: 10;
  }

  /* IMAGE WRAPPER */
  .story-img-wrapper {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    padding: 2px;
    position: relative;
    overflow: visible;
    /* IMPORTANT */
  }


  /* STORY IMAGE */
  .story-img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
  }


  /* ADD STORY PLUS */
  .add-story-plus {
    width: 20px;
    height: 20px;
    background: #0095f6;
    color: white;
    border-radius: 50%;
    font-size: 16px;
    font-weight: bold;
    border: 2px solid #000;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* GRADIENT RING */
  .story-img-wrapper.ring {
    background: linear-gradient(45deg,
        #feda75,
        #fa7e1e,
        #d62976,
        #962fbf);
  }

  /* TEXT */
  .story small {
    display: block;
    margin-top: 4px;
    font-size: 12px;
    text-align: center;
    white-space: nowrap;
    text-overflow: ellipsis;
  }


  /* WRAPPER (CENTER LIKE INSTAGRAM FEED) */
  .stories-wrapper {
    width: 100%;
    margin-bottom: 14px;
  }

  /* STORY BAR */
  .stories-bar {
    display: flex !important;
    flex-direction: row !important;
    gap: 16px;
    padding: 12px 8px 8px 20px;
    overflow-x: auto;
    scrollbar-width: none;
  }

  .stories-bar::-webkit-scrollbar {
    display: none;
  }

  /* STORY ITEM */
  .story-item {
    position: relative;
    width: 72px;
    flex: 0 0 auto;
    text-align: center;
    overflow: visible !important;
  }

  /* AVATAR */
  .story-avatar {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    padding: 2px;
    background: #222;
    overflow: visible;
  }

  .story-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
  }

  /* GRADIENT RING */
  .story-avatar.ring {
    background: linear-gradient(45deg,
        #feda75,
        #fa7e1e,
        #d62976,
        #962fbf);
  }

  /* BLUE + BUTTON (UPLOAD) */
  .story-plus {
    position: absolute;
    bottom: 14px;
    right: 4px;
    width: 22px;
    height: 22px;
    background: #0095f6;
    color: #fff;
    border-radius: 50%;
    font-size: 18px;
    font-weight: bold;
    border: 2px solid #000;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    z-index: 1;
  }

  /* NAME */
  .story-name {
    display: block;
    margin-top: 4px;
    font-size: 12px;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }


  /* MOBILE */
  @media (max-width: 576px) {
    .story-img-wrapper {
      width: 56px;
      height: 56px;
    }
  }


  /* ===== TABLET ===== */
  @media (min-width: 768px) {
    .story-img {
      width: 70px;
      height: 70px;
    }
  }

  /* STORY WRAPPER */
  .story-wrapper {
    display: inline-block;
  }

  /* STORY IMAGE */
  .story-image {
    max-height: 500px;
    width: 100%;
    object-fit: contain;
  }

  /* DELETE BUTTON */
  .delete-story-form {
    position: absolute;
    top: 10px;
    right: 10px;
  }

  .delete-story-btn {
    background: rgba(0, 0, 0, 0.6);
    border: none;
    color: white;
    font-size: 18px;
    border-radius: 50%;
    padding: 6px 8px;
    cursor: pointer;
  }

  .delete-story-btn:hover {
    background: red;
  }

  /* VIEW COUNT */
  .story-views {
    position: absolute;
    bottom: 10px;
    left: 10px;
    background: rgba(0, 0, 0, 0.6);
    color: white;
    font-size: 14px;
    padding: 4px 8px;
    border-radius: 12px;
  }

  /* Prevent background interaction when menu is open */
  .offcanvas-backdrop {
    background-color: rgba(0, 0, 0, 0.6);
  }

  /* Remove blue focus ring */
  button:focus,
  a:focus {
    outline: none !important;
    box-shadow: none !important;
  }

  .offcanvas {
    z-index: 2000;
  }

  .sidebar,
  .main-inner {
    z-index: 1;
  }

  /* ===============================
   INSTAGRAM STYLE MOBILE FEED
================================ */
  @media (max-width: 768px) {

    /* Remove outer padding */
    body,
    .container,
    .container-fluid {
      padding-left: 0 !important;
      padding-right: 0 !important;
      margin: 0 !important;
    }

    /* Remove row gutters */
    .row {
      margin-left: 0 !important;
      margin-right: 0 !important;
    }

    /* Remove column padding */
    .col,
    .col-12,
    .col-md-8,
    .col-lg-6 {
      padding-left: 0 !important;
      padding-right: 0 !important;
    }

    /* Post card full width */
    .post-card,
    .feed-card {
      width: 100%;
      margin: 0 !important;
      border-radius: 0 !important;
      background: #000;
    }

    /* Image container */
    .post-image-wrapper {
  height: 400px;
  overflow: hidden;
}
@media (min-width: 992px) {
  .post-image {
    max-height: 80vh;   /* desktop safe */
  }
}

    /* Image auto adjust */
    .post-image,
    .feed-image,
    .post-card img {
      width: 100%;
      height: auto;
      /* ðŸ”¥ IMPORTANT */
      max-height: 75vh;
      /* Instagram-like */
      object-fit: contain;
      /* NO CROP */
      display: block;
      background: #000;
    }

    /* Inner content padding (likes, caption) */
    .post-body,
    .post-footer,
    .post-actions {
      padding: 10px 12px;
    }
  }

  @media (max-width: 768px) {

    /* Remove padding from post card */
    .post-card {
      padding-left: 0 !important;
      padding-right: 0 !important;
      border-radius: 0 !important;
      margin-bottom: 12px !important;
    }

  }

  @media (max-width: 768px) {

    .post-image {
      width: 100% !important;
      height: auto !important;
      /* ðŸ”¥ IMPORTANT */
      max-height: 75vh;
      /* Instagram feel */
      object-fit: contain;
      /* no crop */
      border-radius: 0 !important;
      box-shadow: none !important;
      display: block;
      background: #000;
    }

  }

  @media (max-width: 768px) {

    .container,
    .container-fluid,
    .row,
    .col,
    .col-12,
    .col-md-8 {
      padding-left: 0 !important;
      padding-right: 0 !important;
      margin-left: 0 !important;
      margin-right: 0 !important;
    }

  }

  @media (max-width: 768px) {

    .post-card>.d-flex,
    .glass-comments,
    .comment-item {
      padding-left: 12px;
      padding-right: 12px;
    }

  }

@media (min-width: 992px) {
  .post-image {
    max-height: 80vh;   /* desktop safe */
  }
}
/* View comments (Instagram style) */
.view-comments-btn,
.toggle-comments-btn {
  background: none;
  border: none;
  padding: 0;
  margin-top: 6px;
  color: #a8a8a8;        /* Instagram gray */
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  text-align: left;
}

.view-comments-btn:hover,
.toggle-comments-btn:hover {
  text-decoration: underline;
  color: #d0d0d0;
}
</style>

{% endblock %}